version: "3.2"

services:
  app:
    image:
      "${LOCKED_APP_IMAGE_DIGEST:-jc5x/firefly-iii:latest}"
    env_file:
      - .app-env
    ports:
      - "7090:80"
    volumes:
      - ./generated_data/export:/var/www/firefly-iii/storage/export
      - ./generated_data/upload:/var/www/firefly-iii/storage/upload
    depends_on:
      - db
    restart:
      unless-stopped

  db:
    image:
      "${LOCKED_DB_IMAGE_DIGEST:-postgres:10}"
    environment:
      - POSTGRES_PASSWORD=firefly
      - POSTGRES_USER=firefly
    volumes:
      - ./generated_data/db:/var/lib/postgresql/data
      - ./scripts:/scripts
    restart:
      unless-stopped
